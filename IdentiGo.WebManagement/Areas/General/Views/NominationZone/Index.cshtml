@model IdentiGo.WebManagement.Areas.General.Models.NominationZoneModel
@using IdentiGo.Domain.Enums

@{
    ViewBag.Title = "Nombramientos";
}

<div class="row">
    <div class="col-sm-12">
        <div class="btn-group pull-right m-t-15">
            <button type="button" class="btn btn-default dropdown-toggle waves-effect waves-light" data-toggle="dropdown" aria-expanded="false">Ajustes <span class="m-l-5"><i class="fa fa-cog"></i></span></button>

            <ul class="dropdown-menu drop-menu-right" role="menu">
                <li><a href="@Url.Action("ExportData")">Exportar Información</a></li>
                <li><a href="@Url.Action("CandidateZoneResponse")">Respuestas de Candidata</a></li>
            </ul>
        </div>

        <h4 class="page-title">Nombramientos</h4>

        <ol class="breadcrumb">
            <li><a href="">General</a></li>

            <li class="active"><a href="@Url.Action("Index")">Nombramientos</a></li>
        </ol>
    </div>
</div>

<div class="row">
    <div class="col-sm-12">
        <div class="card-box table-responsive">
            @using (Html.BeginForm())
            {
                @Html.HiddenFor(model => model.ZoneId)
                {
                    <div class="form-group">
                        @Html.LabelFor(model => model.Document)

                        @Html.TextBoxFor(m => m.Document, new { @class = "form-control" })
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => model.CampaingId)

                        @Html.DropDownListFor(m => m.CampaingId, (SelectList)ViewBag.CampaingList, "Todos", new { @class = "form-control" })
                    </div>

                    <div>
                        @Html.LabelFor(model => model.TypeState)

                        @Html.EnumDropDownListFor(m => m.TypeState, new { @class = "form-control" })
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => model.DateStart)

                        @Html.TextBoxFor(m => m.DateStart, "{0:yyyy-MM-dd}", new { @class = "form-control", type = "date" })
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => model.DateEnd)

                        @Html.TextBoxFor(m => m.DateEnd, "0:yyyy-MM-dd", new { @class = "form-control", type = "date" })
                    </div>

                    <div class="form-group text-right m-b-0">
                        <button class="btn btn-primary waves-effect waves-light" type="submit">
                            Consultar
                        </button>
                    </div>
                }
                if (Model.Init == true && Model.Nomination != null)
                {
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card-box">
                                <h4 class="m-t-0 m-b-30 header-title"><b>Número de Nombramientos</b></h4>

                                <div id="total-pie"></div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="card-box">
                                <h4 class="m-t-0 m-b-30 header-title"><b>Consolidado de Estados</b></h4>

                                <div id="state-pie"></div>
                            </div>
                        </div>
                    </div>

                    <h4 class="m-t-0 header-title"><b>Registros</b></h4>

                    <table id="datatable-filter" class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>
                                    Zona
                                </th>

                                <th>
                                    Código Empresaria
                                </th>

                                <th>
                                    Teléfono Empresaria
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().CodeVerification)
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().Document)
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().Name)
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().LastName)
                                </th>

                                <th>
                                    Teléfono Candidata
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().StageProcess)
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().State)
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().StateDocument)
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().DateCreated)
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().DateNomination)
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().TypeProcess)
                                </th>

                                <th>
                                    Campaña
                                </th>

                                <th width="120">
                                    Acciones
                                </th>
                            </tr>
                        </thead>

                        <tfoot style="display: table-header-group !important;">
                            <tr>
                                <th>
                                    Zona
                                </th>

                                <th>
                                    Código Empresaria
                                </th>

                                <th>
                                    Teléfono Empresaria
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().CodeVerification)
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().Document)
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().Name)
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().LastName)
                                </th>

                                <th>
                                    Teléfono Candidata
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().StageProcess)
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().State)
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().StateDocument)
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().DateCreated)
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().DateNomination)
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.Nomination.FirstOrDefault().TypeProcess)
                                </th>

                                <th>
                                    Campaña
                                </th>

                                <th width="120">
                                    Acciones
                                </th>
                            </tr>
                        </tfoot>

                        <tbody>
                            @foreach (var item in Model.Nomination)
                            {
                                <tr>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Zone.DisplayValue)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.CodeUser)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.PhoneAnswer)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.CodeVerification)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.Document)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.Name)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.LastName)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.PhoneNumber)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.StageProcess)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.State)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.StateDocument)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.DateCreated)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.DateNomination)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.TypeProcess)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.Campaing.Number)
                                    </td>

                                    <td class="actions">
                                        <a href="@Url.Action("Restart", new { id = item.Id })" class="on-default edit-row" title="Reiniciar Proceso"><i class="ion-refresh"></i></a>

                                        <a href="@Url.Action("Details", new { id = item.Id })" class="on-default edit-row" title="Detalle"><i class="ion-android-note"></i></a>

                                        @if (item.StageProcess == StageProccess.Finished && item.State == State.Pass || item.State == State.Success)
                                        {
                                            <a href="@Url.Action("Message", new { id = item.Id })" class="on-default edit-row" title="Enviar SMS"><i class="fa fa-send"></i></a>
                                        } 
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
            }
        </div>
    </div>
</div>

@section Scripts
{
    <script>
        $('#datatable-filter tfoot th').each(function () {
            var title = $(this).text();

            $(this).html('<input type="text" placeholder="Buscar" />');
        });

        var otable = $('#datatable-filter').DataTable({
            "language": {
                "lengthMenu": "Mostrar _MENU_ registros",
                "zeroRecords": "No se encontraron resultados",
                "info": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                "infoEmpty": "No hay registros disponibles",
                "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                "search": "Buscar:",
                "loadingRecords": "Cargando...",
                "paginate": {
                    "first": "Primero",
                    "last": "Último",
                    "next": "Siguiente",
                    "previous": "Anterior"
                },
            },
            "scrollX": true,
            "order": [[8, "desc"]],
            "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "Todos"]],
            dom: '<"top"Bf>rt<"bottom"ilp><"clear">',
            buttons: [{
                extend: "copy",
                text: 'Copiar',
                className: "btn-sm",
                exportOptions: {
                    modifier: {
                        page: 'current'
                    }
                }
            }, {
                extend: "csv",
                className: "btn-sm",
                exportOptions: {
                    modifier: {
                        page: 'current'
                    }
                }
            }, {
                extend: "excel",
                className: "btn-sm",
                exportOptions: {
                    modifier: {
                        page: 'current'
                    }
                }
            }, {
                extend: "pdf",
                className: "btn-sm",
                orientation: 'landscape',
                pageSize: 'TABLOID',
                exportOptions: {
                    modifier: {
                        page: 'current'
                    }
                }
            }, {
                extend: "print",
                text: 'Imprimir',
                className: "btn-sm",
                exportOptions: {
                    modifier: {
                        page: 'current'
                    }
                }
            }],
        });

        otable.columns().every(function () {

            var that = this;
            $('input', this.footer()).on('keyup change', function () {
                if (that.search() !== this.value) {
                    that.search(this.value).draw();
                }
            });
        });

        c3.generate({
            bindto: '#total-pie',
            data: {
                columns: [
                    ['Total ', @Model.Total],
                ],
                type: 'pie',
                width: '165',
                height: '165',
            },
            color: {
                pattern: ["#5fbeaa"]
            },
            pie: {
                label: {
                    show: true,
                    format: function (value, ratio, id) {
                        return d3.format('')(value);
                    }
                }
            }
        });

        c3.generate({
            bindto: '#state-pie',
            data: {
                columns: [
                    ['Pendientes ', @Model.Pending],
                    ['Incumplen ', @Model.Invalid],
                    ['Aprobados ', @Model.Success]
                ],
                type: 'pie',
                width: '165',
                height: '165',
            },
            color: {
                pattern: ["#D9914C", "#D9594C", "#7AB6C2"]
            },
            pie: {
                label: {
                    show: true,
                    format: function (value, ratio, id) {
                        return d3.format('')(value);
                    }
                }
            }
        });
    </script>
}